{% extends "base.html" %}
{% block content %}
{% for meme in data['content'] %}
<div class="meme_block" id="meme_block_{{ meme['id'] }}">
    {% if meme['place'] %}
        <div class="place">{{ meme['place'] }}</div>
    {% endif %}
    <div class="author">
        <div class="test">
            <a href="/autor/{{ meme["author_id"] }}"><img src={{ meme["author_img"] }} class="author_img"></a>
            <div class="author_name"><a href="/autor/{{ meme["author_id"] }}">{{ meme["author_name"] }}</a></div>
            <div class="meme_date">{{ meme["date"] }}</div>
        </div>
    </div>
    {% if meme['type'] == 'meme' %}
        {% if meme["note"] %}
            <div class="note">{{ meme["note"] }}</div>
        {% endif %}
        <img src={{ meme["meme_img"] }} class="meme_img">
        {% if data['info']['is_auth'] %}
            <div class="likes_block">
                {% if meme["is_liked"] %}
                    {% set liked = "like_btn_1" %}
                {% else %}
                    {% set liked = "like_btn_0" %}
                {% endif %}
                {% if meme["is_reposted"] %}
                    {% set reposted = "repost_btn_1" %}
                {% else %}
                    {% set reposted = "repost_btn_0" %}
                {% endif %}
                <img src="http://127.0.0.1:8080/static/img/interface/{{ liked }}.png" class="like_btn" onclick='post("/post", "{\"like\":\"{{ meme["id"] }}\"}"); changeImage1({{ meme["id"] }});' id="l{{ meme["id"] }}">
                <div class="lr_number" id="ln{{ meme["id"] }}">{{ meme["likes"] }}</div>
                <img src="http://127.0.0.1:8080/static/img/interface/{{ reposted }}.png" class="repost_btn" onclick='post("/post", "{\"repost\":\"{{ meme["id"] }}\"}"); changeImage2({{ meme["id"] }});' id="r{{ meme["id"] }}">
                <div class="lr_number" id="rn{{ meme["id"] }}">{{ meme["reposts"] }}</div>
                {% if meme["delete"] %}
                    <div class="delete_btn" onclick='post("/post", "{\"delete\":\"{{ meme["id"] }}\"}"); deleteMeme("meme_block_{{ meme['id'] }}")'>Удалить публикацию</div>
                {% endif %}
            </div>
        {% else %}
            <div class="likes_block auth_note"><a class="auth_note_button" href="/login">Авторизируйтесь</a>, чтобы получить возможность лайкать и репостить публикации</div>
        {% endif %}
        <div class="category">{{ meme['category'] }}</div>
    {% else %}
        {% set meme_r = meme['reposted_content'] %}

        <div class="meme_block margin_top" id="meme_block_{{ meme['id'] }}">
            {% if meme_r['place'] %}
                <div class="place">{{ meme_r['place'] }}</div>
            {% endif %}
            <div class="author">
                <div class="test">
                    <a href="#author_page"><img src={{ meme_r["author_img"] }} class="author_img"></a>
                    <div class="author_name"><a href="#author_page">{{ meme_r["author_name"] }}</a></div>
                    <div class="meme_date">{{ meme_r["date"] }}</div>
                </div>
            </div>
            {% if meme_r["note"] %}
                <div class="note">{{ meme_r["note"] }}</div>
            {% endif %}
            <img src={{ meme_r["meme_img"] }} class="meme_img">
            {% if data['info']['is_auth'] %}
                <div class="likes_block">
                    {% if meme_r["is_liked"] %}
                        {% set liked = "like_btn_1" %}
                    {% else %}
                        {% set liked = "like_btn_0" %}
                    {% endif %}
                    {% if meme_r["is_reposted"] %}
                        {% set reposted = "repost_btn_1" %}
                    {% else %}
                        {% set reposted = "repost_btn_0" %}
                    {% endif %}
                    <img src="http://127.0.0.1:8080/static/img/interface/{{ liked }}.png" class="like_btn" onclick='post("/post", "{\"like\":\"{{ meme_r["id"] }}\"}"); changeImage1({{ meme_r["id"] }});' id="l{{ meme_r["id"] }}_r">
                    <div class="lr_number" id="ln{{ meme_r["id"] }}_r">{{ meme_r["likes"] }}</div>
                    <img src="http://127.0.0.1:8080/static/img/interface/{{ reposted }}.png" class="repost_btn" onclick='post("/post", "{\"repost\":\"{{ meme_r["id"] }}\"}"); changeImage2({{ meme_r["id"] }});' id="r{{ meme_r["id"] }}_r">
                    <div class="lr_number" id="rn{{ meme_r["id"] }}_r">{{ meme_r["reposts"] }}</div>
                    {% if meme_r["delete"] %}
                        <div class="delete_btn" onclick='post("/post", "{\"delete\":\"{{ meme["id"] }}\"}"); deleteMeme("meme_block_{{ meme['id'] }}")'>Удалить публикацию</div>
                    {% endif %}
                </div>
            {% else %}
                <div class="likes_block auth_note"><a class="auth_note_button" href="/login">Авторизируйтесь</a>, чтобы получить возможность лайкать и репостить публикации</div>
            {% endif %}
            <div class="category">{{ meme_r['category'] }}</div>
        </div>
        <div class="likes_block">
            {% if meme["delete"] %}
                <div class="delete_btn" onclick='post("/post", "{\"delete\":\"{{ meme["id"] }}\"}"); deleteMeme("meme_block_{{ meme['id'] }}")'>Удалить публикацию</div>
            {% endif %}
        </div>
    {% endif %}
</div>
{% endfor %}
<div class="meme_block load_button">Загузить ещё</div>


<script>
    function post(url, data, callback) {
        try {
             var req = new(this.XMLHttpRequest || ActiveXObject)('MSXML2.XMLHTTP.3.0');
             req.open('POST', url, 1);
             req.setRequestHeader('Content-type', 'application/json');
             req.send(data)
         } catch (e) {
             window.console && console.log(e);
         }
        }

    function reload() {
        window.location.reload()
    }
    </script>

<script language="javascript">
        function changeImage1(meme_id) {

            if (document.getElementById("l" + meme_id).src == "http://127.0.0.1:8080/static/img/interface/like_btn_0.png")
            {
                document.getElementById("l" + meme_id).src = "http://127.0.0.1:8080/static/img/interface/like_btn_1.png";
                document.getElementById("ln" + meme_id).innerHTML = parseInt(document.getElementById("ln" + meme_id).innerHTML) + 1;
                document.getElementById("l" + meme_id + "_r").src = "http://127.0.0.1:8080/static/img/interface/like_btn_1.png";
                document.getElementById("ln" + meme_id + "_r").innerHTML = parseInt(document.getElementById("ln" + meme_id + "_r").innerHTML) + 1;
            }
            else
            {
                document.getElementById("l" + meme_id).src = "http://127.0.0.1:8080/static/img/interface/like_btn_0.png";
                document.getElementById("ln" + meme_id).innerHTML = parseInt(document.getElementById("ln" + meme_id).innerHTML) - 1;
                document.getElementById("l" + meme_id + "_r").src = "http://127.0.0.1:8080/static/img/interface/like_btn_0.png";
                document.getElementById("ln" + meme_id + "_r").innerHTML = parseInt(document.getElementById("ln" + meme_id + "_r").innerHTML) - 1;
            }
        }
        function changeImage2(meme_id) {

            if (document.getElementById("r" + meme_id).src == "http://127.0.0.1:8080/static/img/interface/repost_btn_0.png")
            {
                document.getElementById("r" + meme_id).src = "http://127.0.0.1:8080/static/img/interface/repost_btn_1.png";
                document.getElementById("rn" + meme_id).innerHTML = parseInt(document.getElementById("rn" + meme_id).innerHTML) + 1;
                document.getElementById("r" + meme_id + "_r").src = "http://127.0.0.1:8080/static/img/interface/repost_btn_1.png";
                document.getElementById("rn" + meme_id + "_r").innerHTML = parseInt(document.getElementById("rn" + meme_id + "_r").innerHTML) + 1;
            }
            else
            {
                document.getElementById("r" + meme_id).src = "http://127.0.0.1:8080/static/img/interface/repost_btn_0.png";
                document.getElementById("rn" + meme_id).innerHTML = parseInt(document.getElementById("rn" + meme_id).innerHTML) - 1;
                document.getElementById("r" + meme_id + "_r").src = "http://127.0.0.1:8080/static/img/interface/repost_btn_0.png";
                document.getElementById("rn" + meme_id + "_r").innerHTML = parseInt(document.getElementById("rn" + meme_id + "_r").innerHTML) - 1;
            }
        }
        function deleteMeme(meme_id) {
            document.getElementById(meme_id).remove();
        }
</script>
{% endblock %}
